(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-im-chat"],{"03ff":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"uni-column"},[i("v-uni-view",{staticClass:"content",style:{height:e.style.contentViewHeight+"px"},attrs:{id:"content"}},[i("v-uni-scroll-view",{style:{height:e.style.contentViewHeight+"px"},attrs:{id:"scrollview","scroll-y":"true","scroll-with-animation":!0,"scroll-top":e.scrollTop}},[i("page-foot",{attrs:{name:e.name}}),e._l(e.messages,function(e,t){return i("message-show",{key:t,attrs:{message:e,cid:t}})}),i("v-uni-view",{attrs:{id:"bottom"}})],2)],1),i("v-uni-view",{staticClass:"foot"},[i("chat-input",{on:{"send-message":function(t){t=e.$handleEvent(t),e.getInputMessage(t)},focus:function(t){t=e.$handleEvent(t),e.inputGetFocus(t)}}})],1)],1)},o=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})},"0407":function(e,t,i){"use strict";var n=i("83a7"),o=i.n(n);o.a},1130:function(e,t,i){"use strict";i.r(t);var n=i("d80b"),o=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},"173b":function(e,t,i){"use strict";i.r(t);var n=i("58f0"),o=i("1130");for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);i("31d4");var s=i("2877"),l=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,"005f9d5d",null);t["default"]=l.exports},"2c6f":function(e,t,i){"use strict";var n=i("5e35"),o=i.n(n);o.a},"2e89":function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,".uni-column[data-v-4375173b]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.content[data-v-4375173b]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;margin-bottom:%?100?%}.foot[data-v-4375173b]{position:fixed;width:100%;height:%?90?%;min-height:%?90?%;left:%?0?%;bottom:%?0?%;overflow:hidden}",""])},"31d4":function(e,t,i){"use strict";var n=i("dba5"),o=i.n(n);o.a},"47a8":function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,'.m-item[data-v-005f9d5d]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:%?40?%}.m-left[data-v-005f9d5d]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:%?120?%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-webkit-align-items:flex-start;-ms-flex-align:start;align-items:flex-start}.m-content[data-v-005f9d5d]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;word-break:break-all}.m-right[data-v-005f9d5d]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:%?120?%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:start;-webkit-align-items:flex-start;-ms-flex-align:start;align-items:flex-start}.head_icon[data-v-005f9d5d]{width:%?80?%;height:%?80?%}.m-content-head[data-v-005f9d5d]{position:relative}.m-content-head-right[data-v-005f9d5d]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end}.m-content-head-home[data-v-005f9d5d]{text-align:left;background:#1482d1;border:%?1?% #1482d1 solid;border-radius:%?20?%;padding:%?20?%;color:#fff}.m-content-head-home[data-v-005f9d5d]:before{border:%?15?% solid rgba(0,0,0,0);border-right:%?15?% solid #1482d1;left:%?-26?%;width:0;height:0;position:absolute;content:" "}.m-content-head-customer[data-v-005f9d5d]{border:%?1?% #fff solid;background:#fff;border-radius:%?20?%;padding:%?20?%}.m-content-head-customer[data-v-005f9d5d]:after{border:%?15?% solid rgba(0,0,0,0);border-left:%?15?% solid #fff;top:%?20?%;right:%?-26?%;width:0;height:0;position:absolute;content:" "}',""])},"58f0":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"m-item",attrs:{id:"message"+e.cid}},[i("v-uni-view",{staticClass:"m-left"},["home"==e.message.user?i("v-uni-image",{staticClass:"head_icon",attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/app/homeHL.png"}}):e._e()],1),i("v-uni-view",{staticClass:"m-content"},[i("v-uni-view",{staticClass:"m-content-head",class:{"m-content-head-right":"customer"==e.message.user}},[i("v-uni-view",{class:"m-content-head-"+e.message.user},[e._v(e._s(e.message.content))])],1)],1),i("v-uni-view",{staticClass:"m-right"},["customer"==e.message.user?i("v-uni-image",{staticClass:"head_icon",attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/app/customerHL.png"}}):e._e()],1)],1)},o=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})},"5e35":function(e,t,i){var n=i("2e89");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=i("4f06").default;o("0257b8d3",n,!0,{sourceMap:!1,shadowMode:!1})},"685f":function(e,t,i){"use strict";i.r(t);var n=i("a359"),o=i("cd2f");for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);i("0407");var s=i("2877"),l=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,"65f3841a",null);t["default"]=l.exports},"83a7":function(e,t,i){var n=i("9846");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=i("4f06").default;o("64776046",n,!0,{sourceMap:!1,shadowMode:!1})},9846:function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,".footer[data-v-65f3841a]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:100%;height:%?80?%;min-height:%?80?%;border-top:solid %?1?% #bbb;overflow:hidden;padding:%?5?%;background-color:#fafafa}.footer-left[data-v-65f3841a]{width:%?80?%;height:%?80?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.footer-right[data-v-65f3841a]{width:%?120?%;height:%?80?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;color:#1482d1}.footer-center[data-v-65f3841a]{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;height:%?80?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.footer-center .input-text[data-v-65f3841a]{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;background:#fff;border:solid %?1?% #ddd;padding:%?10?%!important;font-family:verdana!important;overflow:hidden;border-radius:%?15?%}",""])},a359:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"footer"},[i("v-uni-view",{staticClass:"footer-left"},[i("v-uni-view",{staticClass:"uni-icon uni-icon-mic",on:{click:function(t){t=e.$handleEvent(t),e.startRecognize(t)}}})],1),i("v-uni-view",{staticClass:"footer-center"},[i("v-uni-input",{staticClass:"input-text",attrs:{type:"text"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}})],1),i("v-uni-view",{staticClass:"footer-right",on:{click:function(t){t=e.$handleEvent(t),e.sendMessge(t)}}},[i("v-uni-view",{attrs:{id:"msg-type"}},[e._v("发送")])],1)],1)},o=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})},c562:function(e,t,i){"use strict";i.r(t);var n=i("03ff"),o=i("d1d8");for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);i("2c6f");var s=i("2877"),l=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,"4375173b",null);t["default"]=l.exports},cd2f:function(e,t,i){"use strict";i.r(t);var n=i("f3a1"),o=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},d1d8:function(e,t,i){"use strict";i.r(t);var n=i("eaed"),o=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},d80b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={props:{message:{type:Object,default:function(){return{}}},cid:{type:[Number,String],default:""}}};t.default=n},dba5:function(e,t,i){var n=i("47a8");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=i("4f06").default;o("45da2fd9",n,!0,{sourceMap:!1,shadowMode:!1})},eaed:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(i("685f")),o=a(i("173b"));function a(e){return e&&e.__esModule?e:{default:e}}var s={data:function(){return{name:"xcecd@qq.com",style:{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0},scrollTop:0,messages:[{user:"home",type:"head",content:"你好!"}]}},components:{chatInput:n.default,messageShow:o.default},onLoad:function(e){var t=uni.getSystemInfoSync();this.style.pageHeight=t.windowHeight,this.style.contentViewHeight=t.windowHeight-uni.getSystemInfoSync().screenWidth/750*100;var i=this,n=uni.getStorageSync("token");if(n){i.token=n,i.aid=e.uid;uni.getStorageSync("chat:"+i.aid)}else uni.navigateTo({url:"../login/login/login",success:function(e){},fail:function(){},complete:function(){}});uni.connectSocket({url:i.wss+"/websocket/"+i.token}),uni.onSocketOpen(function(e){}),uni.onSocketMessage(function(e){i.addMessage("home",e.data,!1),i.scrollToBottom()})},methods:{getInputMessage:function(e){this.addMessage("customer",e.content,!1),this.sendMessage(e.content)},addMessage:function(e,t,i,n){var o=this;o.messages.push({user:e,content:t,hasSub:i,subcontent:n})},loadChat:function(e){var t=this;uni.request({url:t.base+"/Mes/save",data:{token:t.token,accid:t.aid,content:e},success:function(e){t.scrollToBottom()}})},sendMessage:function(e){var t=this;uni.request({url:t.base+"/Mes/save",data:{token:t.token,accid:t.aid,content:e},success:function(e){t.scrollToBottom()}})},scrollToBottom:function(){var e=this,t=uni.createSelectorQuery();t.selectAll(".m-item").boundingClientRect(),t.select("#scrollview").boundingClientRect(),t.exec(function(t){e.style.mitemHeight=0,t[0].forEach(function(t){e.style.mitemHeight=e.style.mitemHeight+t.height+20}),e.style.mitemHeight>e.style.contentViewHeight&&(e.scrollTop=e.style.mitemHeight-e.style.contentViewHeight)})},toRobot:function(e){var t=this,i="http://www.tuling123.com/openapi/api";uni.request({url:i,data:{key:"acfbca724ea1b5db96d2eef88ce677dc",info:e,userid:"uni-test"},success:function(e){console.log("s",e),t.addMessage("home",e.data.text,!1),t.scrollToBottom(),console.log("request success:"+e.data.text)},fail:function(e){console.log("request fail",e),uni.showModal({content:e.errMsg,showCancel:!1})}})}}};t.default=s},f3a1:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"chat-input",data:function(){return{inputValue:""}},methods:{startRecognize:function(){var e={},t=this;e.engine="iFly",t.inputValue="",plus.speech.startRecognize(e,function(e){console.log(e),t.inputValue+=e},function(e){console.log("语音识别失败："+e.message)})},sendMessge:function(){var e=this;""==e.inputValue.trim()?e.inputValue="":(this.$emit("send-message",{type:"text",content:e.inputValue}),e.inputValue="")}}};t.default=n}}]);